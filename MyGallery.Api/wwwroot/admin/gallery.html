<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mohamed Bakry - Photography (Admin)</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
        background-color: #fff;
      }
      .navbar {
        padding: 1rem 0;
        background-color: white !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .navbar-brand {
        font-size: 1.5rem;
        font-weight: 500;
        color: #333;
      }
      .navbar-nav .nav-link {
        color: #6c757d;
        margin-left: 1.5rem;
        font-weight: 500;
      }
      .navbar-nav .nav-link:hover {
        color: #6610f2;
      }
      .navbar-nav .nav-link.active {
        color: #6610f2;
      }
      .hero-section {
        text-align: center;
        padding: 5rem 0 3rem 0;
        background-color: #fff;
      }
      .hero-section h1 {
        font-size: 3.5rem;
        margin-bottom: 1.5rem;
        color: #333;
      }
      .hero-section p {
        color: #6c757d;
        max-width: 800px;
        margin: 0 auto;
        font-size: 1.25rem;
        line-height: 1.6;
      }
      .nav-links {
        margin-bottom: 2rem;
      }
      .nav-links a {
        color: #333;
        text-decoration: none;
        margin: 0 1rem;
        font-weight: 500;
      }
      .nav-links a.active {
        color: #6610f2;
      }
      .featured-gallery {
        padding: 2rem 0 4rem 0;
      }
      .featured-gallery .row {
        margin: -10px;
      }
      .featured-gallery .col {
        padding: 10px;
      }
      .featured-gallery img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 8px;
        transition: transform 0.3s ease;
        cursor: pointer;
      }
      .featured-gallery img:hover {
        transform: scale(1.02);
      }
      .featured-gallery .photo-caption {
        position: absolute;
        bottom: 20px;
        left: 20px;
        color: white;
        font-size: 1.2rem;
        font-weight: 500;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }
      .featured-gallery .photo-container {
        position: relative;
        height: 100%;
      }
      .category-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 2.5rem 2rem;
        text-align: center;
        transition: transform 0.3s ease;
        cursor: pointer;
        height: 100%;
        position: relative;
      }
      .category-card:hover {
        transform: translateY(-5px);
      }
      .category-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: #6610f2;
      }
      .category-card h3 {
        margin: 0;
        color: #333;
        font-size: 1.5rem;
      }
      .contact-form {
        padding: 4rem 0;
        background-color: #f8f9fa;
      }
      .nav-tabs {
        border: none;
        margin-bottom: 2rem;
      }
      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        padding: 0.5rem 1rem;
        margin-right: 1rem;
      }
      .nav-tabs .nav-link.active {
        color: #6610f2;
        background: none;
        border-bottom: 2px solid #6610f2;
      }
      .photo-grid {
        padding: 2rem 0;
        /* Grid layout is set through JavaScript */
      }
      .photo-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 2rem;
        break-inside: avoid;
        background-color: #f8f9fa;
      }
      .photo-item img {
        width: 100%;
        height: auto;
        border-radius: 8px;
        transition: transform 0.3s ease;
        display: block;
      }
      .photo-item:hover img {
        transform: scale(1.05);
      }
      .breadcrumb {
        margin: 1rem 0;
        font-size: 0.9rem;
      }
      .breadcrumb a {
        color: #6610f2;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .gallery-title {
        color: #2d3748;
        margin-bottom: 1rem;
      }
      .gallery-description {
        color: #718096;
        margin-bottom: 2rem;
      }
      .filter-tabs {
        margin-bottom: 2rem;
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 1rem;
      }
      .filter-tabs .btn {
        margin-right: 0.5rem;
        border-radius: 20px;
        padding: 0.5rem 1.5rem;
        color: #718096;
        background: none;
        border: 1px solid #e2e8f0;
      }
      .filter-tabs .btn.active {
        background-color: #6610f2;
        color: white;
        border-color: #6610f2;
      }
      #mainView,
      #galleryView {
        min-height: 100vh;
      }
      #galleryView {
        display: none;
      }
      .end-of-gallery {
        text-align: center;
        color: #a0aec0;
        padding: 2rem 0;
        font-style: italic;
      }
      .back-button {
        display: inline-flex;
        align-items: center;
        color: #333;
        text-decoration: none;
        font-size: 1rem;
        margin-bottom: 2rem;
        cursor: pointer;
      }
      .back-button i {
        margin-right: 0.5rem;
      }
      .back-button:hover {
        color: #6610f2;
      }

      /* Lightbox styles */
      .lightbox {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(8px);
        z-index: 1000;
        padding: 0;
      }
      .lightbox.active {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .lightbox-content {
        position: relative;
        max-width: 90%;
        max-height: 90%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .lightbox-img {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        margin: 0 auto;
      }
      .close-lightbox {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        background: rgba(0, 0, 0, 0.5);
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 1003;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .close-lightbox:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      .photo-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.25rem;
        z-index: 1002;
      }
      .photo-nav:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .prev-photo {
        left: 20px;
      }
      .next-photo {
        right: 20px;
      }

      /* Admin styles */
      .admin-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 5px;
        z-index: 10;
      }

      .admin-btn {
        background-color: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .admin-btn:hover {
        background-color: rgba(255, 255, 255, 1);
      }

      .delete-btn {
        color: #dc3545;
      }

      .add-btn {
        color: #28a745;
      }

      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      #addCategoryBtn {
        background-color: #6610f2;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      #addCategoryBtn:hover {
        background-color: #5a0fc1;
      }

      #addPhotoBtn {
        background-color: #6610f2;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 1rem;
      }

      #addPhotoBtn:hover {
        background-color: #5a0fc1;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1050;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        max-width: 90%;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .modal-close {
        font-size: 1.5rem;
        cursor: pointer;
        background: none;
        border: none;
      }

      .modal-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .form-group input,
      .form-group select {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .form-submit {
        background-color: #6610f2;
        color: white;
        border: none;
        padding: 0.5rem;
        border-radius: 4px;
        cursor: pointer;
      }

      .logout-link {
        margin-left: 1.5rem;
        cursor: pointer;
        color: #dc3545;
      }

      .container {
        max-width: 1400px; /* Increased from default 1200px */
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="#">Mohamed Bakry</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#gallery">Gallery</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#contact">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link logout-link" onclick="logout()">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div id="mainView">
      <section class="hero-section">
        <div class="container">
          <h1>Mohamed Bakry Photography</h1>
          <p>Capturing moments and memories through the lens.</p>
        </div>
      </section>

      <section id="gallery" class="featured-gallery">
        <div class="container">
          <div class="admin-header">
            <h2 style="font-size: 2.5rem">Categories</h2>
            <button id="addCategoryBtn" onclick="openAddCategoryModal()">
              <i class="fas fa-plus"></i> Add Category
            </button>
          </div>
          <div
            class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"
            id="categoriesContainer"
          >
            <!-- Categories will be loaded here -->
          </div>
        </div>
      </section>
    </div>

    <div id="galleryView">
      <div class="container">
        <a class="back-button" onclick="showMainView()">
          <i class="fas fa-arrow-left"></i> Back to Categories
        </a>

        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="#" onclick="showMainView()">Home</a>
            </li>
            <li class="breadcrumb-item active" id="categoryBreadcrumb">
              Category
            </li>
          </ol>
        </nav>

        <div class="admin-header">
          <h2
            class="gallery-title"
            id="categoryTitle"
            style="font-size: 2.5rem"
          >
            Category Photos
          </h2>
          <button id="addPhotoBtn" onclick="openAddPhotoModal()">
            <i class="fas fa-plus"></i> Add Photo
          </button>
        </div>

        <div class="photo-grid" id="photosContainer">
          <!-- Photos will be loaded here -->
        </div>

        <div class="end-of-gallery">
          <p>End of gallery</p>
        </div>
      </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
      <div class="lightbox-content">
        <button class="close-lightbox" onclick="closeLightbox()">
          <i class="fas fa-times"></i>
        </button>
        <img
          src=""
          alt="Lightbox image"
          class="lightbox-img"
          id="lightboxImg"
        />
        <button class="photo-nav prev-photo" onclick="prevPhoto()">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="photo-nav next-photo" onclick="nextPhoto()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add New Category</h3>
          <button class="modal-close" onclick="closeModal('addCategoryModal')">
            &times;
          </button>
        </div>
        <form id="addCategoryForm" class="modal-form">
          <div class="form-group">
            <label for="categoryName">Category Name</label>
            <input type="text" id="categoryName" name="categoryName" required />
          </div>
          <button type="submit" class="form-submit">Add Category</button>
        </form>
      </div>
    </div>

    <!-- Add Photo Modal -->
    <div id="addPhotoModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add New Photo</h3>
          <button class="modal-close" onclick="closeModal('addPhotoModal')">
            &times;
          </button>
        </div>
        <form
          id="addPhotoForm"
          class="modal-form"
          enctype="multipart/form-data"
        >
          <div class="form-group">
            <label for="photoImage">Photo Image</label>
            <input
              type="file"
              id="photoImage"
              name="imageFile"
              accept="image/*"
              required
            />
          </div>
          <input type="hidden" id="photoCategoryId" name="categoryId" />
          <button type="submit" class="form-submit">Add Photo</button>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Global variables
      let currentCategory = null;
      let categories = [];
      let currentPhotos = [];
      let currentPhotoIndex = 0;

      // Initialize the app
      document.addEventListener("DOMContentLoaded", function () {
        loadCategories();

        // Add resize handler for responsive columns
        window.addEventListener("resize", function () {
          if (currentPhotos.length > 0) {
            const container = document.getElementById("photosContainer");
            container.style.columnCount =
              window.innerWidth > 1400 ? 3 : window.innerWidth > 900 ? 2 : 1;
          }
        });
      });

      // Load categories
      function loadCategories() {
        fetch("/api/Categories")
          .then((response) => response.json())
          .then((data) => {
            categories = data;
            renderCategories();
          })
          .catch((error) => {
            console.error("Error loading categories:", error);
          });
      }

      // Render categories
      function renderCategories() {
        const container = document.getElementById("categoriesContainer");
        container.innerHTML = "";

        categories.forEach((category) => {
          const categoryIcon = getCategoryIcon(category.name);

          const col = document.createElement("div");
          col.className = "col";
          col.innerHTML = `
            <div class="category-card" onclick="loadCategoryPhotos(${category.id})">
              <div class="admin-controls">
                <button class="admin-btn delete-btn" onclick="deleteCategory(event, ${category.id})">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <div class="category-icon">
                <i class="${categoryIcon}"></i>
              </div>
              <h3>${category.name}</h3>
            </div>
          `;

          container.appendChild(col);
        });
      }

      // Get appropriate icon based on category name
      function getCategoryIcon(categoryName) {
        const name = categoryName.toLowerCase();
        if (name.includes("animal")) return "fas fa-paw";
        if (name.includes("sunset")) return "fas fa-sun";
        if (name.includes("insect")) return "fas fa-bug";
        if (name.includes("random")) return "fas fa-images";
        return "fas fa-image"; // Default icon
      }

      // Load photos for a specific category
      function loadCategoryPhotos(categoryId) {
        currentCategory = categories.find((cat) => cat.id === categoryId);

        // Update UI elements
        document.getElementById("categoryTitle").textContent =
          currentCategory.name;
        document.getElementById("categoryBreadcrumb").textContent =
          currentCategory.name;
        document.getElementById("photoCategoryId").value = categoryId;

        // Fetch the photos
        fetch(`/api/Photos?categoryId=${categoryId}`)
          .then((response) => response.json())
          .then((data) => {
            currentPhotos = data;
            renderPhotos();
            showGalleryView();
          })
          .catch((error) => {
            console.error("Error loading photos:", error);
          });
      }

      // Render photos
      function renderPhotos() {
        const container = document.getElementById("photosContainer");
        container.innerHTML = "";

        // Create masonry-like layout for photos
        container.style.columnCount =
          window.innerWidth > 1400 ? 3 : window.innerWidth > 900 ? 2 : 1;
        container.style.columnGap = "2rem";

        currentPhotos.forEach((photo, index) => {
          const photoItem = document.createElement("div");
          photoItem.className = "photo-item";
          photoItem.innerHTML = `
            <div class="admin-controls">
              <button class="admin-btn delete-btn" onclick="deletePhoto(event, ${photo.id})">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            <img src="${photo.imageUrl}" alt="Photo" onclick="openLightbox(${index})">
          `;

          container.appendChild(photoItem);
        });
      }

      // Show gallery view, hide main view
      function showGalleryView() {
        document.getElementById("mainView").style.display = "none";
        document.getElementById("galleryView").style.display = "block";
      }

      // Show main view, hide gallery view
      function showMainView() {
        document.getElementById("mainView").style.display = "block";
        document.getElementById("galleryView").style.display = "none";
      }

      // Lightbox functions
      function openLightbox(index) {
        currentPhotoIndex = index;
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightboxImg");

        lightboxImg.src = currentPhotos[index].imageUrl;
        lightboxImg.style.objectFit = "contain";

        // Ensure image is centered
        setTimeout(() => {
          lightbox.classList.add("active");
        }, 50); // Small delay to ensure image loads properly

        // Prevent scrolling
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        document.getElementById("lightbox").classList.remove("active");
        // Restore scrolling
        document.body.style.overflow = "";
      }

      function nextPhoto() {
        if (currentPhotoIndex < currentPhotos.length - 1) {
          currentPhotoIndex++;
        } else {
          currentPhotoIndex = 0;
        }
        document.getElementById("lightboxImg").src =
          currentPhotos[currentPhotoIndex].imageUrl;
      }

      function prevPhoto() {
        if (currentPhotoIndex > 0) {
          currentPhotoIndex--;
        } else {
          currentPhotoIndex = currentPhotos.length - 1;
        }
        document.getElementById("lightboxImg").src =
          currentPhotos[currentPhotoIndex].imageUrl;
      }

      // Modal functions
      function openAddCategoryModal() {
        document.getElementById("addCategoryModal").style.display = "block";
      }

      function openAddPhotoModal() {
        document.getElementById("addPhotoModal").style.display = "block";
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      // Add category
      document
        .getElementById("addCategoryForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const categoryName = document.getElementById("categoryName").value;

          fetch("/api/Categories", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ name: categoryName }),
          })
            .then((response) => response.json())
            .then((data) => {
              // Add new category to the array and re-render
              categories.push(data);
              renderCategories();

              // Close modal and reset form
              closeModal("addCategoryModal");
              document.getElementById("addCategoryForm").reset();
            })
            .catch((error) => {
              console.error("Error adding category:", error);
              alert("Failed to add category. Please try again.");
            });
        });

      // Add photo
      document
        .getElementById("addPhotoForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData();
          formData.append(
            "imageFile",
            document.getElementById("photoImage").files[0]
          );
          formData.append(
            "categoryId",
            document.getElementById("photoCategoryId").value
          );

          fetch("/api/Photos", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              // Add new photo to the array and re-render
              currentPhotos.push(data);
              renderPhotos();

              // Close modal and reset form
              closeModal("addPhotoModal");
              document.getElementById("addPhotoForm").reset();
            })
            .catch((error) => {
              console.error("Error adding photo:", error);
              alert("Failed to add photo. Please try again.");
            });
        });

      // Delete category
      function deleteCategory(event, categoryId) {
        event.stopPropagation(); // Prevent opening the category

        if (
          confirm(
            "Are you sure you want to delete this category? This action cannot be undone."
          )
        ) {
          fetch(`/api/Categories/${categoryId}`, {
            method: "DELETE",
          })
            .then((response) => {
              if (response.ok) {
                // Remove category from array and re-render
                categories = categories.filter((cat) => cat.id !== categoryId);
                renderCategories();
              } else {
                return response.json().then((data) => {
                  throw new Error(data || "Failed to delete category");
                });
              }
            })
            .catch((error) => {
              console.error("Error deleting category:", error);
              alert(
                error.message ||
                  "Failed to delete category. It may be in use by photos."
              );
            });
        }
      }

      // Delete photo
      function deletePhoto(event, photoId) {
        event.stopPropagation(); // Prevent opening the lightbox

        if (
          confirm(
            "Are you sure you want to delete this photo? This action cannot be undone."
          )
        ) {
          fetch(`/api/Photos/${photoId}`, {
            method: "DELETE",
          })
            .then((response) => {
              if (response.ok) {
                // Remove photo from array and re-render
                currentPhotos = currentPhotos.filter(
                  (photo) => photo.id !== photoId
                );
                renderPhotos();
                return;
              }
              throw new Error("Failed to delete photo");
            })
            .catch((error) => {
              console.error("Error deleting photo:", error);
              alert("Failed to delete photo. Please try again.");
            });
        }
      }

      // Logout function
      function logout() {
        fetch("/Logout", {
          method: "POST",
          credentials: "include",
        })
          .then((response) => {
            if (response.redirected) {
              window.location = response.url;
            } else {
              window.location = "/login";
            }
          })
          .catch((error) => {
            console.error("Logout error:", error);
            window.location = "/login";
          });
      }
    </script>
  </body>
</html>
