<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mohamed Bakry - Photography</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
        background-color: #fff;
      }
      .navbar {
        padding: 1rem 0;
        background-color: white !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .navbar-brand {
        font-size: 1.5rem;
        font-weight: 500;
        color: #333;
      }
      .navbar-nav .nav-link {
        color: #6c757d;
        margin-left: 1.5rem;
        font-weight: 500;
      }
      .navbar-nav .nav-link:hover {
        color: #6610f2;
      }
      .navbar-nav .nav-link.active {
        color: #6610f2;
      }
      .hero-section {
        text-align: center;
        padding: 5rem 0 3rem 0;
        background-color: #fff;
      }
      .hero-section h1 {
        font-size: 3.5rem;
        margin-bottom: 1.5rem;
        color: #333;
      }
      .hero-section p {
        color: #6c757d;
        max-width: 800px;
        margin: 0 auto;
        font-size: 1.25rem;
        line-height: 1.6;
      }
      .nav-links {
        margin-bottom: 2rem;
      }
      .nav-links a {
        color: #333;
        text-decoration: none;
        margin: 0 1rem;
        font-weight: 500;
      }
      .nav-links a.active {
        color: #6610f2;
      }
      .container {
        max-width: 1400px; /* Increased from default 1200px */
      }
      .featured-gallery {
        padding: 2rem 0 4rem 0;
      }
      .featured-gallery .row {
        margin: -10px;
      }
      .featured-gallery .col {
        padding: 10px;
      }
      .featured-gallery img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 8px;
        transition: transform 0.3s ease;
        cursor: pointer;
      }
      .featured-gallery img:hover {
        transform: scale(1.02);
      }
      .featured-gallery .photo-caption {
        position: absolute;
        bottom: 20px;
        left: 20px;
        color: white;
        font-size: 1.2rem;
        font-weight: 500;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }
      .featured-gallery .photo-container {
        position: relative;
        height: 100%;
      }
      .category-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 2.5rem 2rem;
        text-align: center;
        transition: transform 0.3s ease;
        cursor: pointer;
        height: 100%;
      }
      .category-card:hover {
        transform: translateY(-5px);
      }
      .category-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: #6610f2;
      }
      .category-card h3 {
        margin: 0;
        color: #333;
        font-size: 1.5rem;
      }
      .contact-form {
        padding: 4rem 0;
        background-color: #f8f9fa;
      }
      .nav-tabs {
        border: none;
        margin-bottom: 2rem;
      }
      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        padding: 0.5rem 1rem;
        margin-right: 1rem;
      }
      .nav-tabs .nav-link.active {
        color: #6610f2;
        background: none;
        border-bottom: 2px solid #6610f2;
      }
      .photo-grid {
        padding: 2rem 0;
        /* Grid layout is set through JavaScript */
      }
      .photo-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 2rem;
        break-inside: avoid;
        background-color: #f8f9fa;
      }
      .photo-item img {
        width: 100%;
        height: auto;
        border-radius: 8px;
        transition: transform 0.3s ease;
        display: block;
      }
      .photo-item:hover img {
        transform: scale(1.05);
      }
      .breadcrumb {
        margin: 1rem 0;
        font-size: 0.9rem;
      }
      .breadcrumb a {
        color: #6610f2;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .gallery-title {
        color: #2d3748;
        margin-bottom: 1rem;
        font-size: 2.5rem;
        text-align: center;
      }
      .gallery-description {
        color: #718096;
        margin-bottom: 2.5rem;
        text-align: center;
        font-size: 1.2rem;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }
      .filter-tabs {
        margin-bottom: 2rem;
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 1rem;
      }
      .filter-tabs .btn {
        margin-right: 0.5rem;
        border-radius: 20px;
        padding: 0.5rem 1.5rem;
        color: #718096;
        background: none;
        border: 1px solid #e2e8f0;
      }
      .filter-tabs .btn.active {
        background-color: #6610f2;
        color: white;
        border-color: #6610f2;
      }
      #mainView,
      #galleryView {
        min-height: 100vh;
      }
      #galleryView {
        display: none;
        margin-top: 2.5rem; /* Add spacing from the top for non-home pages */
      }
      .end-of-gallery {
        text-align: center;
        color: #a0aec0;
        padding: 2rem 0;
        font-style: italic;
      }
      .back-button {
        display: inline-flex;
        align-items: center;
        color: #333;
        text-decoration: none;
        font-size: 1rem;
        margin-bottom: 2rem;
        cursor: pointer;
      }
      .back-button i {
        margin-right: 0.5rem;
      }
      .back-button:hover {
        color: #6610f2;
      }

      /* Lightbox styles */
      .lightbox {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(8px);
        z-index: 1000;
        padding: 0;
      }
      .lightbox.active {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .lightbox-content {
        position: relative;
        max-width: 90%;
        max-height: 90%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .lightbox-img {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        margin: 0 auto;
      }
      .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        padding: 1rem;
        border: none;
        cursor: pointer;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
        z-index: 1002;
      }
      .lightbox-nav:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .lightbox-prev {
        left: 20px;
      }
      .lightbox-next {
        right: 20px;
      }
      .lightbox-close {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        background: rgba(0, 0, 0, 0.5);
        border: none;
        font-size: 2rem;
        cursor: pointer;
        z-index: 1003;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .lightbox-close:hover {
        background: rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body>
    <div id="mainView">
      <section class="hero-section">
        <div class="container">
          <h1>Mohamed Bakry</h1>
          <p>
            Beginner photographer passionate about capturing moments. Explore my
            portfolio and discover my journey through the lens.
          </p>
        </div>
      </section>

      <section class="featured-gallery">
        <div class="container">
          <div class="row" id="featuredPhotos">
            <!-- Featured photos will be loaded here dynamically -->
          </div>
        </div>
      </section>

      <section class="py-5" id="categories">
        <div class="container">
          <h2 class="text-center mb-5" style="font-size: 2.5rem">
            Photography Categories
          </h2>
          <div class="row g-4" id="categoriesGrid">
            <!-- Categories will be loaded here -->
          </div>
        </div>
      </section>

      <section class="contact-form" id="contact">
        <div class="container">
          <h2 class="mb-4">Contact</h2>
          <div class="row justify-content-center">
            <div class="col-md-6">
              <form id="contactForm">
                <div class="mb-3">
                  <label for="email" class="form-label">Your Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="message" class="form-label">Message</label>
                  <textarea
                    class="form-control"
                    id="message"
                    rows="5"
                    required
                  ></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                  Send Message
                </button>
              </form>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div id="galleryView">
      <div class="container">
        <h1 class="gallery-title" id="galleryTitle"></h1>
        <p class="gallery-description" id="galleryDescription"></p>

        <div class="photo-grid" id="photoGrid">
          <!-- Photos will be loaded here -->
        </div>

        <div class="end-of-gallery">End of Gallery</div>
      </div>
    </div>

    <div class="lightbox" id="lightbox">
      <button class="lightbox-close" onclick="closeLightbox()">×</button>
      <button class="lightbox-nav lightbox-prev" onclick="showPrevImage()">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div class="lightbox-content">
        <img
          src=""
          alt="Full size photo"
          class="lightbox-img"
          id="lightboxImage"
        />
      </div>
      <button class="lightbox-nav lightbox-next" onclick="showNextImage()">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <script>
      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }

      function scrollToCategories() {
        const categoriesSection = document.getElementById("categories");
        if (categoriesSection) {
          categoriesSection.scrollIntoView({ behavior: "smooth" });
        }
      }

      function showMainView() {
        const mainView = document.getElementById("mainView");
        const galleryView = document.getElementById("galleryView");

        if (mainView) mainView.style.display = "block";
        if (galleryView) galleryView.style.display = "none";

        // Update URL without category
        history.pushState(null, "", "/");
      }

      function showGalleryView() {
        const mainView = document.getElementById("mainView");
        const galleryView = document.getElementById("galleryView");

        if (mainView) mainView.style.display = "none";
        if (galleryView) galleryView.style.display = "block";
      }

      async function loadCategories() {
        try {
          const response = await fetch("/api/Categories");
          const categories = await response.json();
          const categoriesGrid = document.getElementById("categoriesGrid");
          categoriesGrid.className =
            "row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4";

          const icons = {
            Animals: "fa-paw",
            Sunsets: "fa-sun",
            Insects: "fa-bug",
            Sky: "fa-cloud",
            Randoms: "fa-images",
          };

          categories.forEach((category) => {
            const icon = icons[category.name] || "fa-camera";
            const categoryElement = document.createElement("div");
            categoryElement.className = "col";
            categoryElement.innerHTML = `
              <div class="category-card" onclick="showCategoryGallery(${category.id}, '${category.name}')">
                <i class="fas ${icon} category-icon"></i>
                <h3>${category.name}</h3>
              </div>
            `;
            categoriesGrid.appendChild(categoryElement);
          });
        } catch (error) {
          console.error("Error loading categories:", error);
        }
      }

      let currentPhotoIndex = 0;
      let currentPhotos = [];

      function openLightbox(photoUrl, index) {
        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightboxImage");

        currentPhotoIndex = index;
        lightboxImage.src = photoUrl;
        lightboxImage.style.objectFit = "contain";

        // Ensure image is centered
        setTimeout(() => {
          lightbox.classList.add("active");
        }, 50); // Small delay to ensure image loads properly before showing

        // Prevent body scrolling when lightbox is open
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        const lightbox = document.getElementById("lightbox");
        lightbox.classList.remove("active");

        // Restore body scrolling
        document.body.style.overflow = "";
      }

      function showNextImage() {
        if (currentPhotos.length <= 1) return; // No navigation needed for single photo

        currentPhotoIndex = (currentPhotoIndex + 1) % currentPhotos.length;
        document.getElementById("lightboxImage").src =
          currentPhotos[currentPhotoIndex].imageUrl;
      }

      function showPrevImage() {
        if (currentPhotos.length <= 1) return; // No navigation needed for single photo

        currentPhotoIndex =
          (currentPhotoIndex - 1 + currentPhotos.length) % currentPhotos.length;
        document.getElementById("lightboxImage").src =
          currentPhotos[currentPhotoIndex].imageUrl;
      }

      // Add keyboard navigation
      document.addEventListener("keydown", function (e) {
        if (!document.getElementById("lightbox").classList.contains("active"))
          return;

        switch (e.key) {
          case "ArrowLeft":
            showPrevImage();
            break;
          case "ArrowRight":
            showNextImage();
            break;
          case "Escape":
            closeLightbox();
            break;
        }
      });

      async function showCategoryGallery(categoryId, categoryName) {
        try {
          // Update URL with category
          history.pushState(
            { categoryId, categoryName },
            "",
            `/${categoryName.toLowerCase()}`
          );

          // Show gallery view first to ensure elements exist
          showGalleryView();

          // Update title and description
          const titleElement = document.getElementById("galleryTitle");
          const descriptionElement =
            document.getElementById("galleryDescription");

          if (titleElement) {
            titleElement.textContent = `${categoryName} Gallery`;
          }

          if (descriptionElement) {
            descriptionElement.textContent = `Browse the full collection of ${categoryName.toLowerCase()} photography by Mohamed Bakry.`;
          }

          // Load photos
          const response = await fetch(`/api/Photos?categoryId=${categoryId}`);
          const photos = await response.json();
          currentPhotos = photos; // Store photos for lightbox navigation
          const photoGrid = document.getElementById("photoGrid");

          if (photoGrid) {
            photoGrid.innerHTML = "";

            // Create masonry-like layout for photos with larger columns
            photoGrid.style.columnCount =
              window.innerWidth > 1400 ? 3 : window.innerWidth > 900 ? 2 : 1;
            photoGrid.style.columnGap = "2rem";

            // Create a loading message
            const loadingElement = document.createElement("div");
            loadingElement.className = "text-center my-5";
            loadingElement.innerHTML = `<div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading images with their original aspect ratios...</p>`;
            photoGrid.appendChild(loadingElement);

            // Preload images to get dimensions
            const preloadPromises = photos.map((photo, index) => {
              return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                  photo.width = img.width;
                  photo.height = img.height;
                  resolve();
                };
                img.onerror = () => resolve(); // Continue even if error
                img.src = photo.imageUrl;
              });
            });

            // When all images are preloaded
            await Promise.all(preloadPromises);

            // Remove loading message
            photoGrid.innerHTML = "";

            photos.forEach((photo, index) => {
              const photoElement = document.createElement("div");
              photoElement.className = "photo-item";
              photoElement.innerHTML = `
                <img src="${photo.imageUrl}" alt="Photo" onclick="openLightbox('${photo.imageUrl}', ${index})">
              `;
              photoGrid.appendChild(photoElement);
            });
          }
        } catch (error) {
          console.error("Error loading category gallery:", error);
        }
      }

      // Handle browser back/forward buttons
      window.addEventListener("popstate", function (event) {
        if (event.state && event.state.categoryId) {
          showCategoryGallery(event.state.categoryId, event.state.categoryName);
        } else {
          showMainView();
          scrollToTop();
        }
      });

      // Handle window resize for masonry layout
      window.addEventListener("resize", function () {
        const photoGrid = document.getElementById("photoGrid");
        if (photoGrid && currentPhotos.length > 0) {
          photoGrid.style.columnCount =
            window.innerWidth > 1400 ? 3 : window.innerWidth > 900 ? 2 : 1;
        }
      });

      // Load categories when the page loads
      window.addEventListener("load", () => {
        loadCategories();
        loadFeaturedPhotos();
      });
      showMainView(); // Start with main view

      async function loadFeaturedPhotos() {
        try {
          // First get all categories
          const categoriesResponse = await fetch("/api/Categories");
          const categories = await categoriesResponse.json();

          // Then get photos for each category
          const featuredPhotosContainer =
            document.getElementById("featuredPhotos");
          featuredPhotosContainer.innerHTML = ""; // Clear existing content
          featuredPhotosContainer.className =
            "row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4";

          let displayedPhotos = 0;

          for (const category of categories) {
            if (displayedPhotos >= 3) break; // Stop after 3 photos

            const photosResponse = await fetch(
              `/api/Photos?categoryId=${category.id}`
            );
            const photos = await photosResponse.json();

            if (photos && photos.length > 0) {
              const firstPhoto = photos[0];
              const photoElement = document.createElement("div");
              photoElement.className = "col";
              photoElement.innerHTML = `
                <div class="photo-container" onclick="showCategoryGallery(${category.id}, '${category.name}')">
                  <img src="${firstPhoto.imageUrl}" alt="${category.name}">
                  <div class="photo-caption">${category.name}</div>
                </div>
              `;
              featuredPhotosContainer.appendChild(photoElement);
              displayedPhotos++;
            }
          }
        } catch (error) {
          console.error("Error loading featured photos:", error);
        }
      }

      // Handle contact form submission
      document
        .getElementById("contactForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          alert("Thank you for your message! I will get back to you soon.");
          this.reset();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
